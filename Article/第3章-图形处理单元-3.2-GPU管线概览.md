## 3.2 GPU管线概览

GPU实现了[第2章][netlink2.0]中描述的概念:几何处理、光栅化和像素处理流水线阶段。这些阶段被分为几个具有不同程度的可配置性或可编程性的硬件阶段。图3.2显示了根据可编程或可配置程度对各个阶段进行颜色标识。请注意，这些物理阶段的划分与[第2章][netlink2.0]中介绍的功能阶段有些不同。<div align = "center">![Figure3.2]</div><div align = "center">图3.2. 渲染管线的GPU实现。这些阶段根据用户对其操作的控制程度进行颜色标识。绿色阶段是完全可编程的。虚线表示可选阶段。黄色阶段是可配置但不可编程的，例如，可以为合并阶段设置各种混合模式。蓝色阶段的功能完全固定。</div>

我们在此描述GPU的逻辑模型，该模型通过API向作为程序员的你公开。正如[第18章][netlink18.0]和[第23章][netlink23.0]所讨论的，这个逻辑管线的实现，即物理模型，取决于硬件供应商。逻辑模型中固定功能的阶段可以通过向相邻的可编程阶段添加命令而在GPU上执行。流水线中的单个程序可能被拆分为由单独的子单元执行的元素，或者完全由单独的通道执行。逻辑模型可以帮助您推理影响性能的因素，但不应将其误认为是GPU实际实现管道的方式。

顶点着色器是一个完全可编程的阶段，用于实现几何处理阶段。几何着色器是一个完全可编程的阶段，它对图元（点、线或三角形）的顶点进行操作。它可用于执行每个图元的着色操作、销毁图元或创建新图元。曲面细分阶段和几何着色器都是可选的，并非所有GPU都支持它们，尤其是在移动设备上。

裁剪、三角形设置和三角形遍历阶段由固定功能硬件实现。屏幕映射受窗口和视口设置的影响，内部形成简单的缩放和重新定位。像素着色器阶段是完全可编程的。虽然合并阶段不可编程，但它是高度可配置的，可以设置为执行各种操作。它实现了“合并”功能阶段，负责修改颜色、z缓冲区、混合、模板和任何其他与输出相关的缓冲区。像素着色器的执行和合并阶段构成了[第2章][netlink2.0]中介绍的概念：像素处理阶段。

随着时间的推移，GPU管线已经从硬编码操作演变为提高灵活性和控制性。可编程着色器阶段的引入是这一演变中最重要的一步。下一节描述了各种可编程级的共同特征。

[Figure3.2]:Figure/Figure3.2.JPG

[netlink2.0]:https://github.com/fafa1899/RTR-4-CN/blob/main/Pdf/第2章-图形渲染管线-2.0.pdf
[netlink18.0]:https://github.com/fafa1899/RTR-4-CN/blob/main/Pdf/第18章-管线优化-18.0.pdf
[netlink23.0]:https://github.com/fafa1899/RTR-4-CN/blob/main/Pdf/第23章-图形硬件-23.0.pdf