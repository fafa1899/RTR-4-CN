# 4.5 变形

在执行动画时，从一个三维模型到另一个三维模型的变形会很有用[28,883,1000,1005]。假设在时间$t_0$显示一个模型，我们希望它在时间$t_1$之前变成另一个模型。对于$t_0$和$t_1$之间的所有时间，使用某种插值获得连续的“混合”模型。变形的一个例子如图4.14所示。

<div align = "center">

![Figure4.14]

</div>

<div align = "center">

**图4.14**. 顶点变形。为每个顶点定义了两个位置和法线。在每一帧中，中间位置和法线由顶点着色器线性插值。（图片由 NVIDIA 公司提供。）

</div>

变形涉及解决两个主要问题，即顶点对应问题和插值问题。给定两个任意模型，它们可能具有不同的拓扑、不同的顶点数量和不同的网格连接，通常必须从设置这些顶点对应关系开始。这是一个难题，在这方面已经有很多研究。感兴趣的读者推荐参考Alexa的论述[28]。

但是，如果两个模型之间已经存在一对一的顶点对应关系，则可以在每个顶点的基础上进行插值。也就是说，对于第一个模型中的每个顶点，第二个模型中必须只有一个顶点，反之亦然。这使得插值成为一项简单的任务。例如，可以直接在顶点上使用线性插值（[第17.1节][netlink17.1]介绍了其他进行插值的方法）。为了计算时间$t∈[t_0,t_1]$的变形顶点，我们首先计算$s = (t−t_0)/(t_1−t_0 )$，然后计算线性顶点混合:
$$
\textbf{m} = (1 − s)\textbf{p}_0 + s\textbf{p}_1 \tag{4.60} 
$$


其中$\textbf{p}_0$和$\textbf{p}_1$对应于不同的时间($t_0$和$t_1$)但相同的顶点。

用户能够更直观控制变形的变体，被称为变形目标或混合形状[907]。可以使用图4.15解释基本思想。

<div align = "center">

![Figure4.15]

</div>

<div align = "center">

**图4.15**. 给定两个嘴巴姿势，计算一组差异向量来控制插值，甚至外插。在变形目标中，差异向量用于将运动“添加”到中性面部。使用差异向量的正权重，我们会得到一张微笑的嘴，而负权重会产生相反的效果。

</div>

我们从一个中性模型开始，在这种情况下是一张脸。让我们用$\mathcal{N}$表示这个模型。此外，我们还有一组不同的面部姿势。在示例插图中，只有一个姿势，即笑脸。一般来说，我们可以允许$k≥1$个不同的姿势，表示为$\mathcal{P}_i, i∈[1,...,k]$。作为预处理，“差异人脸”计算为：$\mathcal{D}_i = \mathcal{P}_i -\mathcal{N}$，即从每个姿势中减去中性模型。


此时，我们有一个中性模型$\mathcal{N}$和一组差异姿势$\mathcal{D}_i$。然后可以使用以下公式获得变形模型 $\mathcal{M}$：
$$
\mathcal{M} = \mathcal{N} + \sum^{k}_{i=1}w_i\mathcal{D}_i  \tag{4.61}
$$

这是中性模型，最重要的是我们根据需要添加不同姿势的特征，使用权重$w_i$。对于图4.15，设置$w_1 = 1$给了我们图中间的笑脸。使用$w_1 = 0.5$会给我们一张半笑脸，依此类推。还可以使用负权重和大于1的权重。

对于这个简单的人脸模型，我们可以添加另一个具有“悲伤”眉毛的脸。对眉毛使用负权重可以创建“快乐”眉毛。由于位移是累加的，所以这个眉毛姿势可以与微笑嘴巴的姿势结合使用。

变形目标是一种强大的技术，它为动画师提供了很多控制权，因为模型的不同特征可以独立于其他特征进行操作。刘易斯等在文献[1037]中引入了姿势空间变形，它结合了顶点混合和变形目标。Senior[1608]使用预先计算的顶点纹理来存储和检索目标姿势之间的位移。支持流输出的硬件和每个顶点的ID允许在单个模型中使用更多的目标，并且只在GPU上计算效果[841,1074]。使用低分辨率网格，然后通过细分阶段和位移映射生成高分辨率网格，避免了在高度详细的模型中为每个顶点蒙皮的成本[1971]。

图4.16显示了同时使用蒙皮和变形的真实示例。Weronko和Andreason[1872]在游戏《教团：1886》中使用了蒙皮和变形。

<div align = "center">

![Figure4.16] 

</div>

<div align = "center">

**图4.16**. 在《声名狼藉：私生子》中，Delsin角色的脸部使用混合形状进行动画处理。所有这些镜头都使用相同的静止姿势脸部，然后修改不同的权重以使脸部看起来不同。（图片由Naughty Dog LLC（《声名狼藉：私生子》© 2014 索尼互动娱乐）提供。《声名狼藉：私生子》是索尼互动娱乐的品牌。由Sucker Punch Productions工作室开发。）

</div>

[Figure4.14]:Figure/Figure4.14.JPG
[Figure4.15]:Figure/Figure4.15.JPG
[Figure4.16]:Figure/Figure4.16.JPG

[netlink17.1]:netlink17.1

